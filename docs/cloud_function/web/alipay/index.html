<!DOCTYPE html>
<html lang="en">
    <head>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta content="Bmob,BmobCloud,bomb,BaaS,mBaaS,PaaS,Serverless,FaaS,Function as a Service,Backend as a Service,serverless computing,cloud function,后端云,bmob后端云,小程序云,小程序后端,云数据库,云存储,文件存储,云函数,云端代码,定时任务,游戏后端,游戏云,用户系统,无服务器函数,移动开发,app开发,小程序开发,云端一体化,互联网中间件" name="keywords"/>
            <meta content="国内首家专注于移动应用Serverless云服务的平台,Bmob后端云让移动开发更简单,全方位一体化的后端服务平台" name="description"/>
            
            
            
            <link rel="shortcut icon" href="../../../img/favicon.ico">

        <!-- <script type="text/javascript" src="//game.bmobapp.com/static/doc_union.js"></script> -->
            <!--
            <title>支付宝App支付 - Bmob文档中心</title>
            -->
            <title>云函数 &middot; Web – Bmob后端云 </title>  
            
            <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
            <link href="../../../css/font-awesome-4.5.0.css" rel="stylesheet">
            <link href="../../../css/base.css" rel="stylesheet">
            <link rel="stylesheet" href="../../../css/highlight.css">
            <link href="../../../css/agate.css" rel="stylesheet">
            <link href="../../../css/custom.css" rel="stylesheet" id="custom">
    </head>

    <body >

        <div class="navbar navbar-fixed-top" role="navigation">
    <div class="main-nav">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <a class="navbar-brand" href="../../..">
                <!--Bmob文档中心-->
                <img src="../../../img/logo.png" alt="">
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

          <ul class="nav navbar-nav">
            
              <li class="pull-left">
                
					<a href="../../..">文档首页</a>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="">数据服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">数据服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
								<li >
									<a href="../../../data/android/">Android</a>
                                </li>
                            
                            
								<li >
									<a href="../../../data/ios/">iOS</a>
                                </li>
                            
                            
                                <li >
                                    <a href="../../../data/harmony/">harmony鸿蒙</a>
                                </li>
							
                            
								<li >
									<a href="../../../data/csharp/">C#</a>
                                </li>
                            
                            
								<li >
									<a href="../../../data/php/">PHP</a>
                                </li>
                            
                            
								<li >
									<a href="../../../data/go/">GO</a>
                                </li>
                            
                            
								<li >
									<a href="../../../data/restful/">REST API</a>
                                </li>
                            
                            
								<li >
									<a href="../../../data/wechat_app_new/rm/">JavaScript</a>
                                </li>
                            
                            
                                <li >
                                    <a href="../../../data/cocos2d_x/">Cocos2D-X</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../data/wechat_app_new/">快应用</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../data/wechat_app_new/">Nodejs</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../data/wechat_app_new/">Cocos Creator</a>
                                </li>
							
                            
								<li >
									<a href="../../../data/wechat_app_new/rm/">小程序</a>
                                </li>
                            
                            
                                <li >
                                    <a href="../../../data/kotlin/">Kotlin</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../data/python/">Python</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../data/flutter/">Flutter</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left active">
                
					<!--<a href="">云函数</a>-->
					<li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">云函数 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
								<li class="active">
									<a href="../">云函数开发文档</a>
                                </li>
                            
                            
                                <li >
                                    <a href="../../android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../java/">Java</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../python/">Python</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../csharp/">C#</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../php/">PHP</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../javascript/">JavaScript</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../restful/">REST API</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../../sms/android/">短信服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">短信服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../../sms/android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../sms/ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../sms/php/">PHP</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../sms/javascript/">JavaScript</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../sms/restful/">REST API</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../sms/python/">python</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../../ai/android/">AI人工智能</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">AI人工智能 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../../ai/android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../ai/ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../ai/html5/">小程序</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../ai/html5/">Html5</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../ai/api/">API</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../ai/python/">python</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../../other/domain/">其他</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">其他 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../../other/domain/">域名管理</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../other/common_problem/">常见问题</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../other/error_code/">错误码</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../other/data_safety/">数据安全</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../../other/bql/">BQL</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li>
                  <a href="https://www.bmobapp.com/repository/index" target="_blank">知识库</a>
              </li>
              <li>
                  <a href="http://doc.bmobapp.com/video/index.html" target="_blank">视频教程</a>
              </li>
            </ul>

        </div>
    </div>
</div>

        <div class="pagebody" id="main-wrapper">
            <div class="sidebar">
                <div class="bs-sidebar hidden-print affix well" role="complementary">

	
		
	
		
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
		
	
		
				
					<div class="code-title">云函数开发文档</div>
				
				
				
				
				
				
				
				
				
		
	
		
				
				
				
				
				
				
		
	
		
				
				
				
				
				
				
		
	
		
				
				
				
				
				
		
	


	<ul class="nav bs-sidenav">
		
			
		
			
		
			
				
					
						
							
								
									<li class="">
										<a class="itm-l1" href="../">快速入门</a>
										
									</li>
								
									<li class="">
										<a class="itm-l1" href="../develop_doc/">开发文档</a>
										
									</li>
								
									<li class="">
										<a class="itm-l1" href="../hook/">数据钩子</a>
										
									</li>
								
									<li class="active">
										<a class="itm-l1" href="./">支付宝App支付</a>
										
										<ul class="nav">
											
											<li class="active "><a href="#_1">简介</a>
												
											</li>
												
											<li class=""><a href="#_2">一、前置准备</a>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#11">1.1 支付宝开放平台配置</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#12">1.2 密钥获取与配置</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#13-bmob">1.3 Bmob 环境准备</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#14-order">1.4 数据表设计（Order 表）</a></li>
												</ul>
												
											</li>
												
											<li class=""><a href="#_4">二、核心功能开发</a>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#21">2.1 云函数入口设计</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#22">2.2.生成支付订单代码</a></li>
												</ul>
												
											</li>
												
											<li class=""><a href="#_8">支付宝支付云函数详细说明</a>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#_9">一、函数概述</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#_10">二、函数流程详解</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#_11">三、异常处理机制</a></li>
												</ul>
												
												<ul class="nav nav-l2">
													<li><a class="itm-l2" href="#_12">四、使用注意事项</a></li>
												</ul>
												
											</li>
												
										</ul>
										
									</li>
								
									<li class="">
										<a class="itm-l1" href="../timing_tasks/">定时任务</a>
										
									</li>
								
									<li class="">
										<a class="itm-l1" href="../weixin/">微信云函数</a>
										
									</li>
								
									<li class="">
										<a class="itm-l1" href="../norm/">编码规范</a>
										
									</li>
								
							
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
						
					
				
			
		
			
		
			
		
			
		
	</ul>
</div>
            </div>
            <div class="content" role="main">
                <div class="wrap">
                    

<h2 id="_1">简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本教程将引导你完成如下的支付宝 App 接入任务，实现一个 App 支付功能：</p>
<ul>
<li>把订阅者发送到公众号后台的反馈意见存储在在Bmob中的 <code>message</code> 表。</li>
<li>收到反馈意见后，公众号自动给订阅者发送消息，表示消息已收到。</li>
<li>小程序网页也是一样的，查看支付宝开发文档</li>
</ul>
<h2 id="_2">一、前置准备<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="11">1.1 支付宝开放平台配置<a class="headerlink" href="#11" title="Permanent link">&para;</a></h3>
<ul>
<li>1.1.1 注册 / 登录支付宝开放平台账号（<a href="https://open.alipay.com/">https://open.alipay.com</a>）</li>
<li>1.1.2 创建应用（选择 “自研应用”，应用类型为 “APP”）</li>
<li>1.1.3 应用状态激活（完成实名认证、签约 “APP 支付” 能力）</li>
</ul>
<h3 id="12">1.2 密钥获取与配置<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<ul>
<li>1.2.1 生成密钥对（推荐使用支付宝开放平台提供的 “密钥生成工具”）</li>
<li>下载地址：<a href="https://opendocs.alipay.com/open/291/105971">支付宝开放平台文档中心 - 密钥工具</a></li>
<li>生成方式：选择 “RSA2” 加密方式，生成 PKCS8 格式密钥（Node.js 环境推荐）</li>
<li>1.2.2 配置公钥到支付宝开放平台</li>
<li>登录应用→开发设置→接口加签方式→上传 “应用公钥”</li>
<li>保存并获取 “支付宝公钥”（用于验签）</li>
</ul>
<p>查看密钥</p>
<p><img alt="alipaykey" src="../image/alipaykey.png" /></p>
<h3 id="13-bmob">1.3 Bmob 环境准备<a class="headerlink" href="#13-bmob" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>1.3.1 云函数创建（新建<code>alipayPayment</code>云函数）</p>
</li>
<li>
<p>1.3.2 依赖（云函数使用的是<code>alipay-sdk</code>3.6 版本，请查看 3.6 版本文档 https://www.npmjs.com/package/alipay-sdk/v/3.6.2）</p>
</li>
<li>
<p>1.3.3 数据表设计（<code>Order</code>表字段规范）</p>
</li>
<li>必选字段：<code>outTradeNo</code>（支付订单号）、<code>totalAmount</code>（金额，分）、<code>status</code>（订单状态）等</li>
<li>关联字段：<code>userId</code>（用户 ID）、<code>productId</code>（商品 ID）等</li>
</ul>
<h3 id="14-order">1.4 数据表设计（Order 表）<a class="headerlink" href="#14-order" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>列注释</th>
<th>默认值</th>
<th>约束 / 说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>id</strong></td>
<td>Number</td>
<td>订单 id（自增主键）</td>
<td>未设置</td>
<td>自增唯一值，用于订单唯一标识（Bmob 自动生成）</td>
</tr>
<tr>
<td>productId</td>
<td>String</td>
<td>商品 id</td>
<td>未设置</td>
<td>关联商品表的唯一标识</td>
</tr>
<tr>
<td>status</td>
<td>Number</td>
<td>订单状态（0：未支付；1：已支付）</td>
<td>未设置</td>
<td>默认为空，创建订单时需指定初始状态</td>
</tr>
<tr>
<td>userId</td>
<td>String</td>
<td>用户 id</td>
<td>未设置</td>
<td>关联用户表的唯一标识</td>
</tr>
<tr>
<td>playDate</td>
<td>Date</td>
<td>支付时间</td>
<td>未设置</td>
<td>支付成功后更新，格式为 <code>YYYY-MM-DD HH:mm:ss</code></td>
</tr>
<tr>
<td>orderDate</td>
<td>Date</td>
<td>下单时间</td>
<td>未设置</td>
<td>创建订单时自动填充当前时间</td>
</tr>
<tr>
<td>playType</td>
<td>Number</td>
<td>支付方式（0：支付宝；1：微信）</td>
<td>未设置</td>
<td>区分不同支付渠道</td>
</tr>
<tr>
<td>discount</td>
<td>Number</td>
<td>优惠折扣（如 0.9 表示 9 折）</td>
<td>未设置</td>
<td>支持小数，无折扣时可设为 1</td>
</tr>
<tr>
<td>orderNum</td>
<td>String</td>
<td>订单编号（外部支付系统用）</td>
<td>未设置</td>
<td>全局唯一，格式为 <code>ORDER_时间戳_随机字符串</code></td>
</tr>
<tr>
<td>orderName</td>
<td>String</td>
<td>订单名称</td>
<td>未设置</td>
<td>对应支付接口的 <code>subject</code> 字段</td>
</tr>
<tr>
<td>totalAmount</td>
<td>Number</td>
<td>订单金额（单位：分）</td>
<td>0</td>
<td>以分为单位存储，避免浮点数精度问题</td>
</tr>
</tbody>
</table>
<h4 id="_3">字段设计说明：<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>id（主键）</strong></li>
<li>Bmob 会自动生成自增唯一的 <code>objectId</code>（字符串类型），若需显式使用数字类型主键，可在创建表时开启「自增 ID」功能</li>
<li>用途：内部系统关联订单（如查询、更新订单状态）</li>
<li><strong>orderNum 与 id 的区别</strong></li>
<li><code>id</code>：内部系统用主键，仅用于 Bmob 数据表操作</li>
<li><code>orderNum</code>：外部支付系统用编号，需传递给支付宝 / 微信支付接口（对应 <code>out_trade_no</code>）</li>
<li><strong>totalAmount 设计</strong></li>
<li>单位为「分」，存储整数（如 19800 表示 198.00 元）</li>
<li>避免使用小数存储金额，防止计算精度问题（如 0.01 元的误差）</li>
<li><strong>时间字段</strong></li>
<li><code>orderDate</code>：创建订单时必须填充（建议用当前时间）</li>
<li><code>playDate</code>：支付成功后由异步通知回调更新，未支付时为空</li>
<li><strong>状态字段</strong></li>
<li><code>status</code> 与 <code>playType</code> 均使用 Number 类型，便于后续扩展状态（如新增「已取消」状态码 2）</li>
</ol>
<h2 id="_4">二、核心功能开发<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 云函数入口设计<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>云函数入口接收客户端请求参数，处理后返回标准化响应格式，确保前后端交互一致性。</p>
<h4 id="211-requestbody">2.1.1 请求参数规范（<code>request.body</code>字段说明）<a class="headerlink" href="#211-requestbody" title="Permanent link">&para;</a></h4>
<p>客户端需通过 <code>request.body</code> 传递以下 JSON 格式参数：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>数据类型</th>
<th>是否必填</th>
<th>说明</th>
<th>示例值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>productId</code></td>
<td>String</td>
<td>是</td>
<td>商品唯一标识，关联商品表</td>
<td><code>"PROD_123456"</code></td>
</tr>
<tr>
<td><code>userId</code></td>
<td>String</td>
<td>是</td>
<td>用户唯一标识，关联用户表</td>
<td><code>"USER_789"</code></td>
</tr>
<tr>
<td><code>orderName</code></td>
<td>String</td>
<td>是</td>
<td>订单标题，将作为支付接口的 <code>subject</code></td>
<td><code>"数据恢复产品 A"</code></td>
</tr>
<tr>
<td><code>total_amount</code></td>
<td>Number</td>
<td>是</td>
<td>订单总金额（单位：元），支持两位小数</td>
<td><code>198.01</code></td>
</tr>
</tbody>
</table>
<p><strong>请求参数示例</strong>：</p>
<p>json</p>
<pre><code class="json">{
  &quot;productId&quot;: &quot;PROD_123456&quot;,
  &quot;userId&quot;: &quot;USER_789&quot;,
  &quot;orderName&quot;: &quot;数据恢复产品 A&quot;,
  &quot;total_amount&quot;: 198.01
}
</code></pre>

<h4 id="212">2.1.2 响应格式定义<a class="headerlink" href="#212" title="Permanent link">&para;</a></h4>
<p>云函数处理完成后，返回标准化 JSON 响应，包含状态码、业务数据和描述信息：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
<th>取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>code</code></td>
<td>Number</td>
<td>响应状态码： - 200：成功 - 400：参数错误 - 500：系统错误</td>
<td><code>200</code>/<code>400</code>/<code>500</code></td>
</tr>
<tr>
<td><code>data</code></td>
<td>Object</td>
<td>业务数据对象，成功时返回支付相关信息</td>
<td>成功时非空，失败时可为 <code>null</code></td>
</tr>
<tr>
<td><code>msg</code></td>
<td>String</td>
<td>响应描述信息，说明操作结果</td>
<td>成功 / 错误提示文本</td>
</tr>
</tbody>
</table>
<p><strong><code>data</code> 对象字段说明</strong>：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>数据类型</th>
<th>说明</th>
<th>示例值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>orderStr</code></td>
<td>String</td>
<td>支付宝支付请求字符串，客户端需传递给支付宝 SDK</td>
<td><code>"method=alipay.trade.app.pay&amp;app_id=2021005190686707&amp;..."</code></td>
</tr>
<tr>
<td><code>outTradeNo</code></td>
<td>String</td>
<td>商户生成的唯一订单号，用于跟踪支付状态</td>
<td><code>"ORDER_1757663434644_cs6xps9jy"</code></td>
</tr>
</tbody>
</table>
<p><strong>成功响应示例</strong>：</p>
<pre><code class="json">{
  &quot;code&quot;: 200,
  &quot;data&quot;: {
    &quot;orderStr&quot;: &quot;method=alipay.trade.app.pay&amp;app_id=xxxx&amp;charset=utf-8&amp;version=1.0&amp;sign_type=RSA2&amp;timestamp=2025-09-12%2015%3A50%3A34&amp;biz_content=%7B%22out_trade_no%22%3A%22ORDER_1757663434644_cs6xps9jy%22%2C%22total_amount%22%3A198.01%2C%22subject%22%3A%22%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E4%BA%A7%E5%93%81%20A%22%2C%22body%22%3A%22%E8%AE%A2%E5%8D%95ORDER_1757663434644_cs6xps9jy%22%2C%22notify_url%22%3A%22https%3A%2F%2Fcloud.siton.xin%2F1f09fc11dd0e3f90%2FpayNotify%22%2C%22return_url%22%3A%22https%3A%2F%2Fcloud.siton.xin%2F1f09fc11dd0e3f90%2FpayNotify%22%2C%22product_code%22%3A%22QUICK_MSECURITY_PAY%22%2C%22timeout_express%22%3A%2230m%22%7D&amp;sign=Z5GgIZGgji4vJ%2B%2B3ELiE9f6WvGKYc8RriqfiM8IFNBS13129nzHlYo8EOR0m5BAEvuCqp3Ro80zFDZmHgJoaX8FerkBfOOUz4bkc8q6fOLy2EYlIGoF%2B6%2FXB2DBdK4Ur32GylUk4Rb6we41ITH1j7Y2wVKb5aqnxu2D3HHvjPEZvW8FiF%2B7%2F7%2FBYtkLytDE2c1X2Jtb3z%2Fnq72C%2B7asrs00p1k5XeQlloGoMOj4wIqTkCFFc7kaQamRZa5p2TAHiGRutAEbWzZRgRrOomOWcamFdoXY7Q4IORRBQkfW%2FfEGpX9syX0BCYslixailneebiyjv0vLUgYizVbVWs%2BoUng%3D%3D&quot;,
    &quot;outTradeNo&quot;: &quot;ORDER_1757663434644_cs6xps9jy&quot;
  },
  &quot;msg&quot;: &quot;支付信息获取成功&quot;
}
</code></pre>

<p><strong>错误响应示例（系统异常）</strong>：</p>
<pre><code class="json">{
  &quot;code&quot;: 500,
  &quot;data&quot;: null,
  &quot;msg&quot;: &quot;创建订单记录失败，请稍后重试&quot;
}
</code></pre>

<h4 id="_5">设计说明<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>参数精简</strong>：仅保留业务必需的 4 个请求参数，减少客户端传递成本</li>
<li><strong>类型明确</strong>：<code>total_amount</code> 定义为 Number 类型，支持小数金额（如 <code>198.01</code>）</li>
<li><strong>响应标准化</strong>：成功 / 错误响应格式统一，便于客户端统一解析处理</li>
<li><strong>关联性</strong>：<code>outTradeNo</code> 与订单表的 <code>orderNum</code> 字段一一对应，用于后续支付状态同步</li>
</ol>
<h3 id="22">2.2.生成支付订单代码<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<h4 id="221-pay">2.2.1  生成支付订单（函数名：pay）<a class="headerlink" href="#221-pay" title="Permanent link">&para;</a></h4>
<p>完整可用的代码，创建一个名为"pay"的云函数用于实现支付功能，并且保存订单到订单表，这里调用了另外一个数据表新增函数</p>
<p>代码如下：</p>
<pre><code class="js">function onRequest(request, response, modules) {
    // 防止重复发送响应
    let isResponseSent = false;
    const sendResponse = (code, data, msg) =&gt; {
        if (!isResponseSent) {
            isResponseSent = true;
            response.send({ code, data, msg });
        }
    };

    try {
        // 1. 引入依赖和初始化
        const AlipaySdk = require('alipay-sdk').default;
        const functions = modules.oFunctions;

        // 2. 支付宝配置
        const config = {
            appId: '2021xxx',
            privateKey: ``,
            // 支付宝公钥 - 请填写支付宝公钥（注意：这里需要的是公钥格式，不是证书格式）
            alipayPublicKey: ``,
            keyType: 'PKCS8',
            signType: 'RSA2',
            gateway: 'https://openapi.alipay.com/gateway.do',
            timeout: 30000
        };

        // 3. 参数验证（订单表所需参数）
        const {
            productId,
            userId,
            orderName,
            total_amount, // 支付金额（从请求体获取）
            body // 订单描述（可选）
        } = request.body;

        // 验证必要参数
        const requiredParams = [
            productId, userId, orderName, total_amount
        ];
        if (requiredParams.some(param =&gt; param === undefined || param === null || param === '')) {
            return sendResponse(400, null, &quot;参数不完整，请检查必填字段&quot;);
        }

        // 4. 生成唯一订单号（用于支付系统）
        const outTradeNo = `ORDER_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

        // 5. 先调用addOrder函数创建订单表记录
        console.log('开始创建订单表记录...');
        functions.run({
            name: &quot;addOrder&quot;,
            data: {
                productId,
                userId,
                orderName,
                outTradeNo, // 将支付订单号关联到订单表
                totalAmount: total_amount // 记录订单金额
            }
        }, function (err, addOrderResult) {
            if (err) {
                console.error('创建订单表失败:', err);
                return sendResponse(500, null, &quot;创建订单记录失败，请稍后重试&quot;);
            }

            console.log('订单表创建成功，开始创建支付订单...', addOrderResult, err);

            // addOrderResult  {&quot;createdAt&quot;:&quot;2025-09-12 15:32:41&quot;,&quot;objectId&quot;:&quot;4313ac6aa3&quot;}
            try {
                // 将字符串转换为对象
                let orderData;
                if (typeof addOrderResult === 'string') {
                    orderData = JSON.parse(addOrderResult);
                } else {
                    orderData = addOrderResult;
                }

                // 验证objectId是否存在
                if (!orderData || !orderData.objectId) {
                    console.error('订单创建结果中缺少objectId:', orderData);
                    return sendResponse(500, null, &quot;创建订单记录不完整，请稍后重试&quot;);
                }
            } catch (payError) {
                console.error('创建支付订单失败:', payError);
                sendResponse(500, null, &quot;创建支付信息失败，格式错误&quot; + payError);
            }

            // 6. 订单表创建成功后，创建支付宝支付订单
            try {
                // 初始化支付宝SDK
                const alipaySdk = new AlipaySdk({
                    appId: config.appId,
                    privateKey: config.privateKey,
                    alipayPublicKey: config.alipayPublicKey,
                    gateway: config.gateway,
                    signType: config.signType,
                    keyType: config.keyType,
                    timeout: config.timeout
                });

                // 构建支付参数
                const payParams = {
                    out_trade_no: outTradeNo,
                    total_amount: total_amount,
                    subject: orderName, // 用订单名称作为支付标题
                    body: body || `订单${outTradeNo}`, // 支付描述
                    notify_url: 'https://cloud.siton.xin/xxxx/payNotify',
                    return_url: 'https://cloud.siton.xin/xxxx/payNotify'
                };

                // 创建APP支付订单
                const orderStr = alipaySdk.sdkExec('alipay.trade.app.pay', {
                    bizContent: {
                        ...payParams,
                        product_code: 'QUICK_MSECURITY_PAY',
                        timeout_express: '30m'
                    }
                });

                console.log('支付订单创建成功，订单号:', outTradeNo);
                sendResponse(200, {
                    orderStr,
                    outTradeNo,
                    orderId: addOrderResult.orderId // 假设addOrder返回订单ID
                }, &quot;支付信息获取成功&quot;);

            } catch (payError) {
                console.error('创建支付订单失败:', payError);
                sendResponse(500, null, &quot;创建支付信息失败，请稍后重试&quot;);
            }
        });

    } catch (error) {
        console.error('系统异常:', error);
        sendResponse(500, null, &quot;系统异常，请稍后重试&quot;);
    }
}

</code></pre>

<p>这个云函数的内容暂时看不懂没关系，后面面会逐渐解释其中的含义 [支付宝支付云函数详细说明]。</p>
<p>这个是接口调用结果</p>
<p><img alt="bmob-alipay" src="../image/bmob-alipay.png" /></p>
<h4 id="222-addorder">2.2.2  订单表插入数据（函数名：addOrder）<a class="headerlink" href="#222-addorder" title="Permanent link">&para;</a></h4>
<p>这里由上一个支付函数调用，其他地方不需要调用，功能就是创建一条订单。</p>
<pre><code>function onRequest(request, response, modules) {
    const db = modules.oData;

    // 1. 参数验证
    const {
        productId,
        userId,
        playDate,
        orderDate,
        discount,
        orderName,
        totalAmount
    } = request.body;

    let status = 0
    let orderNum = request.body.outTradeNo

    if (!productId) {
        response.end(&quot;缺少参数: productId&quot;);
        return;
    }

    if (status === undefined) {
        response.end(&quot;缺少参数: status&quot;);
        return;
    }

    if (!userId) {
        response.end(&quot;缺少参数: userId&quot;);
        return;
    }

    if (!orderNum) {
        response.end(&quot;缺少参数: orderNum&quot;);
        return;
    }

    if (!orderName) {
        response.end(&quot;缺少参数: orderName&quot;);
        return;
    }

    let intTotaAmount =parseFloat(totalAmount);
    // 验证转换结果
    if (isNaN(intTotaAmount) || intTotaAmount &lt;= 0) {
        response.end(&quot;金额格式无效: intTotaAmount&quot;);
        return;
    }

    // 2. 构造订单数据对象
    const orderData = {
        productId,
        status,
        userId,
        orderNum,
        totaAmount:intTotaAmount,
        orderName
    };

    //   当前 时间
    const formatCurrentTime = () =&gt; {
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    };

    if (orderDate) {
        orderData.orderDate = {
            &quot;__type&quot;: &quot;Date&quot;,
            &quot;iso&quot;: formatCurrentTime()
        };
    }

    orderData.discount = 1;
    orderData.playType = 1;


    // 3. 执行插入操作
    db.insert({
        table: &quot;Order&quot;,
        data: orderData
    }, (err, data) =&gt; {
         console.log('orderData', err, data);
        // 4. 错误处理
        if (err) {
            response.send(err);
            return;
        }

        // 5. 成功响应
        data = JSON.parse(data);
        response.send({ objectId: data.objectId });
    });
}
</code></pre>

<h4 id="223">2.2.3  支付宝回调处理<a class="headerlink" href="#223" title="Permanent link">&para;</a></h4>
<p>简单来说，支付宝回调函数就像一个 "快递签收通知"—— 当用户在你的 App 里用支付宝付款后，支付宝会主动 "打电话" 告诉你这笔钱的支付结果，而这个 "接电话并处理消息" 的函数，就是回调函数。简而言之，就是支付宝来告诉你，这个客户支付成功了，这时候你修改下订单状态即可。</p>
<pre><code>function onRequest(request, response, modules) {
    // 防止重复响应
    let responseSent = false;
    const sendResponse = (data) =&gt; {
        if (!responseSent) {
            responseSent = true;
            response.send(data);
        }
    };

    try {
        const AlipaySdk = require('alipay-sdk').default;
        const db = modules.oData;

        // 1. 支付宝配置
        const config = {
            appId: '2021xxx', // 替换为实际APPID
            privateKey: '', // 商户私钥
            alipayPublicKey: '', // 支付宝公钥
            signType: 'RSA2',
            keyType: 'PKCS8'
        };

        // 2. 初始化支付宝SDK
        const alipaySdk = new AlipaySdk({
            appId: config.appId,
            privateKey: config.privateKey,
            alipayPublicKey: config.alipayPublicKey,
            signType: config.signType,
            keyType: config.keyType
        });

        // 3. 获取通知参数
        const notifyParams = request.body;
        console.log('收到支付宝通知:', JSON.stringify(notifyParams));

        // 4. 验证通知签名
        const verifyResult = alipaySdk.checkSign(notifyParams);
        if (!verifyResult) {
            console.error('通知签名验证失败:', notifyParams);
            return sendResponse('fail'); // 必须返回字符串&quot;fail&quot;
        }

        // 5. 验证通知类型和状态
        if (notifyParams.notify_type !== 'trade_status_sync') {
            console.warn('非支付状态同步通知:', notifyParams.notify_type);
            return sendResponse('success'); // 非支付状态通知也返回success
        }

        // 6. 处理支付结果
        const {
            out_trade_no, // 商户订单号
            trade_no,    // 支付宝交易号
            trade_status,// 交易状态
            total_amount // 支付金额
        } = notifyParams;

        // 验证关键参数存在
        if (!out_trade_no || !trade_status) {
            console.error('通知缺少关键参数', { out_trade_no, trade_status });
            return sendResponse('fail');
        }

        // 7. 根据交易状态处理订单
        if (trade_status === 'TRADE_SUCCESS' || trade_status === 'TRADE_FINISHED') {
            // 8. 查询订单是否已处理（幂等性处理）
            db.findOne({
                table: 'Order',
                where: { orderNum: out_trade_no }
            }, (err, orderData) =&gt; {
                if (err) {
                    console.error('查询订单失败:', err);
                    return sendResponse('fail');
                }

                if (!orderData) {
                    console.error('订单不存在:', out_trade_no);
                    return sendResponse('fail');
                }

                // 9. 检查订单当前状态
                if (orderData.status === 1) {
                    console.log('订单已处理:', out_trade_no);
                    return sendResponse('success'); // 已处理过直接返回成功
                }

                // 10. 更新订单状态
                const updateData = {
                    status: 1, // 标记为已支付
                    tradeNo: trade_no, // 保存支付宝交易号
                    payTime: {
                        &quot;__type&quot;: &quot;Date&quot;,
                        &quot;iso&quot;: new Date().toISOString().replace('T', ' ').split('.')[0]
                    },
                    actualPayAmount: total_amount // 实际支付金额
                };

                db.update({
                    table: 'Order',
                    id: orderData.objectId,
                    data: updateData
                }, (updateErr) =&gt; {
                    if (updateErr) {
                        console.error('更新订单失败:', updateErr);
                        return sendResponse('fail');
                    }

                    console.log('订单支付成功并更新:', out_trade_no);
                    sendResponse('success');
                });
            });
        } else {
            // 处理其他状态（如未支付、关闭等）
            console.log(`订单状态: ${trade_status}, 订单号: ${out_trade_no}`);

            // 可选：更新订单为失败状态
            if (['TRADE_CLOSED', 'TRADE_FAILED'].includes(trade_status)) {
                db.update({
                    table: 'Order',
                    where: { orderNum: out_trade_no },
                    data: { status: 2 } // 2表示支付失败
                }, (err) =&gt; {
                    if (err) console.error('更新失败状态出错:', err);
                    sendResponse('success');
                });
            } else {
                sendResponse('success');
            }
        }

    } catch (error) {
        console.error('回调处理异常:', error);
        sendResponse('fail');
    }
}

</code></pre>

<h5 id="_6">为什么必须要有这个函数？<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<ul>
<li>没有它，你就不知道用户是否真的付了钱</li>
<li>无法自动更新订单状态，可能导致用户付款后无法使用服务</li>
<li>缺少安全验证，可能有人伪造 "支付成功" 的假消息骗走你的商品 / 服务</li>
</ul>
<h5 id="_7">新手需要注意的关键点：<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h5>
<ol>
<li>这个函数必须能被互联网访问（支付宝服务器要能找到它）</li>
<li>一定要返回 "success" 或 "fail" 这两个单词，其他内容会导致支付宝重复发通知</li>
<li>签名验证非常重要，不能跳过（防止假通知）</li>
<li>要处理 "重复通知" 的情况（支付宝可能多次发送同一通知）</li>
</ol>
<h1 id="_8">支付宝支付云函数详细说明<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h1>
<h2 id="_9">一、函数概述<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p><strong>函数名称</strong>：支付宝支付云函数（<code>onRequest</code>）
<strong>功能描述</strong>：处理客户端支付请求，先创建订单记录，再生成支付宝支付参数，返回给客户端用于发起支付
<strong>依赖资源</strong>：</p>
<ul>
<li><code>alipay-sdk</code>：支付宝开放平台 SDK</li>
<li><code>modules.oFunctions</code>：Bmob 云函数调用工具</li>
<li><code>addOrder</code>：前置订单创建云函数</li>
</ul>
<h2 id="_10">二、函数流程详解<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<h3 id="21_1">2.1 初始化与基础配置<a class="headerlink" href="#21_1" title="Permanent link">&para;</a></h3>
<h4 id="211">2.1.1 防重复响应机制<a class="headerlink" href="#211" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">let isResponseSent = false;
const sendResponse = (code, data, msg) =&gt; {
    if (!isResponseSent) {
        isResponseSent = true;
        response.send({ code, data, msg });
    }
};
</code></pre>

<ul>
<li>作用：防止因异步操作导致的重复响应问题</li>
<li>实现：通过<code>isResponseSent</code>标记位控制，确保<code>response.send</code>仅执行一次</li>
</ul>
<h4 id="212_1">2.1.2 支付宝配置参数<a class="headerlink" href="#212_1" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const config = {
    appId: '2021xxx',               // 支付宝应用ID
    privateKey: ``,                 // 应用私钥（需填写实际密钥）
    alipayPublicKey: ``,            // 支付宝公钥（需填写实际公钥）
    keyType: 'PKCS8',               // 密钥格式（Node.js推荐PKCS8）
    signType: 'RSA2',               // 签名算法（RSA2为推荐标准）
    gateway: 'https://openapi.alipay.com/gateway.do', // 支付宝网关
    timeout: 30000                  // 超时时间（30秒）
};
</code></pre>

<ul>
<li>配置说明：生产环境需替换为实际的密钥和 appId，测试环境可使用支付宝沙箱网关</li>
</ul>
<h3 id="22_1">2.2 参数处理与验证<a class="headerlink" href="#22_1" title="Permanent link">&para;</a></h3>
<h4 id="221">2.2.1 请求参数解析<a class="headerlink" href="#221" title="Permanent link">&para;</a></h4>
<p>从<code>request.body</code>中提取以下参数：</p>
<pre><code class="javascript">const {
    productId,       // 商品ID（必填）
    userId,          // 用户ID（必填）
    orderName,       // 订单名称（必填）
    total_amount,    // 支付金额（必填，单位：元）
    body             // 订单描述（可选）
} = request.body;
</code></pre>

<h4 id="222">2.2.2 参数验证逻辑<a class="headerlink" href="#222" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const requiredParams = [productId, userId, orderName, total_amount];
if (requiredParams.some(param =&gt; param === undefined || param === null || param === '')) {
    return sendResponse(400, null, &quot;参数不完整，请检查必填字段&quot;);
}
</code></pre>

<ul>
<li>验证规则：检查所有必填参数是否存在（非<code>undefined</code>/<code>null</code>/ 空字符串）</li>
<li>错误响应：参数不完整时返回<code>400</code>状态码</li>
</ul>
<h3 id="23">2.3 订单创建流程<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<h4 id="231">2.3.1 生成唯一订单号<a class="headerlink" href="#231" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const outTradeNo = `ORDER_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
</code></pre>

<ul>
<li>格式：<code>ORDER_时间戳_随机字符串</code></li>
<li>作用：作为商户系统与支付宝的唯一订单标识，确保全局唯一性</li>
</ul>
<h4 id="232-addorder">2.3.2 调用<code>addOrder</code>创建订单记录<a class="headerlink" href="#232-addorder" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">functions.run({
    name: &quot;addOrder&quot;,
    data: {
        productId,
        userId,
        orderName,
        outTradeNo,       // 关联支付订单号
        totalAmount: total_amount  // 订单金额（元）
    }
}, function(err, addOrderResult) { ... });
</code></pre>

<ul>
<li>调用参数：传递必要的订单信息，包括与支付关联的<code>outTradeNo</code></li>
<li>回调处理：<code>addOrder</code>执行完成后进入回调函数，处理结果或错误</li>
</ul>
<h4 id="233">2.3.3 订单创建结果校验<a class="headerlink" href="#233" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">// 字符串转对象处理
let orderData;
if (typeof addOrderResult === 'string') {
    orderData = JSON.parse(addOrderResult);
} else {
    orderData = addOrderResult;
}

// 验证objectId存在
if (!orderData || !orderData.objectId) {
    console.error('订单创建结果中缺少objectId:', orderData);
    return sendResponse(500, null, &quot;创建订单记录不完整，请稍后重试&quot;);
}
</code></pre>

<ul>
<li>转换逻辑：将<code>addOrder</code>返回的字符串结果转换为对象（<code>addOrder</code>返回格式为<code>{"createdAt":"2025-09-12 15:32:41","objectId":"4313ac6aa3"}</code>）</li>
<li>关键验证：必须包含<code>objectId</code>（订单记录唯一标识），否则视为创建失败</li>
</ul>
<h3 id="24">2.4 支付宝支付参数生成<a class="headerlink" href="#24" title="Permanent link">&para;</a></h3>
<h4 id="241-sdk">2.4.1 初始化支付宝 SDK<a class="headerlink" href="#241-sdk" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const alipaySdk = new AlipaySdk({
    appId: config.appId,
    privateKey: config.privateKey,
    alipayPublicKey: config.alipayPublicKey,
    gateway: config.gateway,
    signType: config.signType,
    keyType: config.keyType,
    timeout: config.timeout
});
</code></pre>

<ul>
<li>作用：创建支付宝 SDK 实例，用于后续调用支付接口</li>
</ul>
<h4 id="242">2.4.2 构建支付参数<a class="headerlink" href="#242" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const payParams = {
    out_trade_no: outTradeNo,              // 商户订单号
    total_amount: total_amount,            // 支付金额（元）
    subject: orderName,                    // 订单标题
    body: body || `订单${outTradeNo}`,     // 订单描述（默认值为订单号）
    notify_url: 'https://cloud.siton.xin/xxxxxxxx/payNotify', // 异步通知地址
    return_url: 'https://cloud.siton.xin/xxxxxxxx/payNotify'  // 同步跳转地址
};
</code></pre>

<ul>
<li>核心参数：<code>out_trade_no</code>与订单表关联，<code>total_amount</code>与订单金额保持一致</li>
</ul>
<h4 id="243">2.4.3 生成支付请求字符串<a class="headerlink" href="#243" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">const orderStr = alipaySdk.sdkExec('alipay.trade.app.pay', {
    bizContent: {
        ...payParams,
        product_code: 'QUICK_MSECURITY_PAY', // APP支付固定产品码
        timeout_express: '30m'               // 订单超时时间（30分钟）
    }
});
</code></pre>

<ul>
<li>接口说明：调用<code>alipay.trade.app.pay</code>接口生成 APP 支付参数</li>
<li>返回结果：<code>orderStr</code>为 URL 编码的支付参数字符串，供客户端调用支付宝 SDK 使用</li>
</ul>
<h3 id="25">2.5 响应处理<a class="headerlink" href="#25" title="Permanent link">&para;</a></h3>
<h4 id="251">2.5.1 成功响应<a class="headerlink" href="#251" title="Permanent link">&para;</a></h4>
<pre><code class="javascript">sendResponse(200, {
    orderStr,          // 支付宝支付参数字符串
    outTradeNo,        // 商户订单号
    orderId: addOrderResult.orderId  // 订单表记录ID
}, &quot;支付信息获取成功&quot;);
</code></pre>

<ul>
<li>响应内容：包含发起支付所需的核心参数，客户端可直接使用<code>orderStr</code>调用支付宝</li>
</ul>
<h4 id="252">2.5.2 错误响应场景<a class="headerlink" href="#252" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>错误场景</th>
<th>状态码</th>
<th>错误信息示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>参数不完整</td>
<td>400</td>
<td>"参数不完整，请检查必填字段"</td>
</tr>
<tr>
<td>订单创建失败</td>
<td>500</td>
<td>"创建订单记录失败，请稍后重试"</td>
</tr>
<tr>
<td>订单结果缺少 objectId</td>
<td>500</td>
<td>"创建订单记录不完整，请稍后重试"</td>
</tr>
<tr>
<td>支付参数生成失败</td>
<td>500</td>
<td>"创建支付信息失败，请稍后重试"</td>
</tr>
<tr>
<td>系统异常</td>
<td>500</td>
<td>"系统异常，请稍后重试"</td>
</tr>
</tbody>
</table>
<h2 id="_11">三、异常处理机制<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>参数级异常</strong>：在流程最开始验证，快速返回错误</li>
<li><strong>订单创建异常</strong>：通过<code>functions.run</code>的<code>err</code>参数捕获，记录日志并返回</li>
<li><strong>JSON 解析异常</strong>：使用<code>try-catch</code>处理<code>addOrderResult</code>转换失败的情况</li>
<li><strong>支付接口异常</strong>：捕获<code>alipaySdk.sdkExec</code>可能抛出的签名错误、参数错误等</li>
<li><strong>全局异常</strong>：最外层<code>try-catch</code>捕获未处理的意外错误</li>
</ol>
<h2 id="_12">四、使用注意事项<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<ol>
<li>替换<code>config</code>中的<code>appId</code>、<code>privateKey</code>、<code>alipayPublicKey</code>为实际值</li>
<li>确认<code>notify_url</code>和<code>return_url</code>为可访问的 HTTPS 地址（支付宝要求）</li>
<li><code>addOrder</code>函数需正确返回包含<code>objectId</code>的结果（格式：<code>{"createdAt":"时间","objectId":"ID值"}</code>）</li>
<li>测试环境建议使用支付宝沙箱环境（网关替换为<code>https://openapi.alipaydev.com/gateway.do</code>）</li>
</ol>
                </div>
            </div>
        </div>

        
            <script>var base_url = '../../..';</script>
            <script src="../../../js/jquery-1.10.2.min.js"></script>
            <script src="../../../js/bootstrap-3.0.3.min.js"></script>
            <script src="../../../js/highlight.pack.js"></script>
            <script src="../../../js/main.js"></script>
            <script src="../../../js/base.js"></script>

		<!--
        <div id="go-top"><i class="fa fa-chevron-up"></i></div>
        <a href="https://docs.bmobapp.com/data/Android/a_faststart/doc/index.html" id="back" target="_blank">返回 <br> 旧版</a>
		-->
    </body>

</html>